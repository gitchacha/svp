/**
 * Alopex Grid Pivot Plugin v1.0.3
 * http://grid.alopex.io
 *
 * Copyright (c) 2018 SK Holdings C&C. All rights reserved.
 * 
 * This software is the confidential and proprietary information of SK Holdings C&C.
 * You shall not disclose such confidential information and shall use it only in
 * accordance with the terms of the license agreement you entered into with SK Holdings C&C.
 *
 * Date : 2019-04-25 15:26:02 GMT+0900 (대한민국 표준시)
 **/
+function(t){function e(t){return!(null===t||void 0===t)}function n(e,o){var a=this;if(a.option={},a.state={},a.usedKeyMap={},this===window||null==this||this===T.plugin)if("function"==typeof Object.create)a=Object.create(n.prototype);else{var i=function(){};i.prototype=n.prototype,a=new i,i.prototype=null}return a.setGrid(e),a.option.width=I(o,"width",1e3),a.option.height=I(o,"height",500),a.option.rowHeight=I(o,"rowHeight",20),a.option.nodataMsg=I(o,"nodataMsg","데이터가 없습니다"),a.option.filterNodataMsg=I(o,"filterNodataMsg","데이터가 없습니다"),a.option.data=I(o,"data",[],!0),a.option.keyMapping=I(o,"keyMapping",[],!0),a.option.rowSetting=I(o,"rowSetting",{}),a.option.columnSetting=I(o,"columnSetting",{}),a.option.assistSetting=I(o,"assistSetting",{}),a.option.valueSetting=I(o,"valueSetting",{}),a.option.configuration=I(o,"configuration",{}),a.option.keyDblClickAct=I(o,"keyDblClickAct",null),a.option.defaultSortingDirection=I(o,"defaultSortingDirection","asc"),a.option.dataRender=I(o,"dataRender",null),a.option.keyRender=I(o,"keyRender",function(t){return"["+t+"]"}),a.option.keyRenderHidden=I(o,"keyRenderHidden",null),a.option.contextMenuTitle=I(o,"contextMenuTitle",{hideSubtotal:AlopexGrid.i18n("hideGroupSummary"),showSubtotal:AlopexGrid.i18n("showGroupSummary"),sortAscending:AlopexGrid.i18n("sortAscending"),sortDescending:AlopexGrid.i18n("sortDescending"),showFilterDropdown:AlopexGrid.i18n("showFilterDropdown"),showAssistArea:AlopexGrid.i18n("showHorizontalColumn"),hideAssistArea:AlopexGrid.i18n("hideHorizontalColumn"),showAssistHandle:AlopexGrid.i18n("showHorizontalDragColumn"),hideAssistHandle:AlopexGrid.i18n("hideHorizontalDragColumn"),showValueDropDown:AlopexGrid.i18n("showValueDropDown")}),a.option.contextMenuOn=I(o,"contextMenuOn",{showSubtotal:!0,sort:!0,filterDropdown:!0,showAssistArea:!0,showAssistHandle:!1,valueDropDownn:!0}),a.state.statsColumnOption=I(o,"statsColumnOption",{}),a.state.values=I(o,"values",[],!0),a.state.enabledValues=I(o,"enabledValues",{}),a.state.groupKeys=I(o,"groupKeys",[],!0),a.state.rows=I(o,"rows",[],!0),a.state.columns=I(o,"columns",[],!0),a.state.groupSortingMap=I(o,"groupSortingMap",{}),a.state.widthInRowSetting=I(o,"widthInRowSetting",70),a.state.widthInValueSetting=I(o,"widthInValueSetting",40),a.state.columnWidthMap=I(o,"columnWidthMap",{}),a.state.statsClassMap=I(o,"statsClassMap",{}),a.state.showAssistAreaInAreaSetting=I(o,"showAssistAreaInAreaSetting",!1),a.state.assistTitleWidthInAssistSetting=I(o,"assistTitleWidthInAssistSetting",50),a.state.showAssistHandleInAreaSetting=I(o,"showAssistHandleInAreaSetting",!0),a.state.assistHandleWidthInAssistSetting=I(o,"assistHandleWidthInAssistSetting",20),a.state.assistButtonWidthInAssistSetting=I(o,"assistButtonWidthInAssistSetting",50),a.state.showDataKeyInColumnSetting=I(o,"showDataKeyInColumnSetting",!1),a.state.dragToTopInColumnSetting=I(o,"dragToTopInColumnSetting",!1),a.state.assistButtonPositionInAreaSetting=I(o,"assistButtonPositionInAreaSetting","horizontal"),a.state.assistButtonTitleInAreaSetting=I(o,"assistButtonTitleInAreaSetting","Values"),a.state.showSubtotalInColumnSetting=I(o,"showSubtotalInColumnSetting",!0),a.state.showSubtotalMap=I(o,"showSubtotalMap",{}),a.state.showGrandTotalInColumnSetting=I(o,"showGrandTotalInColumnSetting",!0),a.state.subtotalTitleInColumnSetting=I(o,"subtotalTitleInColumnSetting","TOTAL"),a.state.subtotalTitleInRowSetting=I(o,"subtotalTitleInRowSetting","TOTAL"),a.state.subtotalTitleMap=I(o,"subtotalTitleMap",{}),a.state.showSubtotalInRowSetting=I(o,"showSubtotalInRowSetting",!0),a.state.showGrandTotalInRowSetting=I(o,"showGrandTotalInRowSetting",!0),a.state.statsRenderInValueSetting=I(o,"statsRenderInValueSetting",function(t){return AlopexGrid.renderUtil.addCommas(t||0)}),a.state.statsRenderMap=I(o,"statsRenderMap",{}),a.state.statsParserInValueSetting=I(o,"statsParserInValueSetting",function(t){return(t||"").replace(",","")}),a.state.statsParserMap=I(o,"statsParserMap",{}),a.state.statsFunctionInValueSetting=I(o,"statsFunctionInValueSetting",null),a.state.statsFunctionMap=I(o,"statsFunctionMap",{}),a.state.keyRenderInRowSetting=I(o,"keyRenderInRowSetting",null),a.state.keyRenderInColumnSetting=I(o,"keyRenderInColumnSetting",null),a.state.keyRenderMap=I(o,"keyRenderMap",{}),a.state.dataRenderMap=I(o,"dataRenderMap",{}),a.state.keyRenderInValueSetting=I(o,"keyRenderInValueSetting",null),a.state.statsColumnOptionMap=I(o,"statsColumnOptionMap",{}),a.option.renderCallback=I(o,"renderCallback",t.Callbacks()),a.option.gridOption=I(o,"gridOption",{preGrouper:{},postGrouper:{},preFact:{},postFact:{}}),t(e).data(T.KEY_NAME+"grouper",a).attr("data-alopexgridpivot",T.KEY_NAME+"grouper"),a.setInitialArea(),a.setData(o.data),a.enableAllValue(),a.render(),a.state.configFlag=a._generateConfig(),1==a.state.configFlag&&a._configEventHandler(),t.extend(!0,a,n.commonOption),a}function o(){!0===n.debug&&(N?console.log(t.makeArray(arguments).join(" ")):console.log.apply(console,arguments))}function a(){!0===n.debug&&(N?console.error?console.error(t.makeArray(arguments).join(" ")):console.log(t.makeArray(arguments).join(" ")):console.error?console.error.apply(console,arguments):console.log.apply(console,arguments))}function i(e){return!!(e&&t.isArray(e)&&e.length)}function r(e){return!(!e||!t.isPlainObject(e)||t.isEmptyObject(e))}function s(t){return t}function l(t,e){var n={};return n.value=t,n.prop="[object Object]"===Object.prototype.toString.call(e,e)?e:{},n.parent=null,n.children=[],n}function u(t,e){return t.children.push(e),e.parent=t}function p(t){return t.value}function d(t){return t.children}function g(t){return t.parent}function c(t){return t.prop}function h(t){return!t.parent}function f(t){return!t.children.length}function w(e,n){var o=d(e);return t.map(o,function(t){if(p(t)===n)return t})}function y(t,e){return w(t,e)[0]}function m(t){for(var e=[];t&&g(t);)e.push(t=g(t));return e}function v(e,n){e&&(t.each(d(e),function(t,e){v(e,n)}),n&&n(e))}function C(){}function S(t,e,n,o){for(var a=0,i=!!t.state.filteredDataList,r=0,s=e.length;r<s;r++){var l=e[r],u=!0;for(var p in o)if(o.hasOwnProperty(p)&&l[p]!==o[p]){u=!1;break}i&&!l._state.filtered&&(u=!1),u&&(a+=parseInt(l[n])||0)}return a}function M(t,e,n,o,a){for(var i=[],r=!!t.state.filteredDataList,s=0,l=e.length;s<l;s++){var u=e[s],p=!0;for(var d in o)if(o.hasOwnProperty(d)&&u[d]!==o[d]){p=!1;break}r&&!u._state.filtered&&(p=!1),p&&i.push(a?u:u[n])}return i}function x(t){var e=parseInt(1e4*Math.random());return n.classNameMap.configId+(t?t+"-":"")+e}function b(e,n,o,a){for(var i=e.length,r=[],s=0;s<i;s++){var l={};"string"==typeof e[s]?(l[n]=e[s],o&&(a[e[s]]=o),r.push(l)):"object"==typeof e[s]&&(l[n]=e[s].key,o&&(a[e[s].key]=o),r.push(l))}return o&&t(o).alopexGrid("dataSet",r),r}function A(t,e){for(var n=t.length,o=[],a=0;a<n;a++)o.push(t[a][e]);return o}function G(t){return t.indexOf(n.classNameMap.configId+"column")>-1?"column":t.indexOf(n.classNameMap.configId+"row")>-1?"row":t.indexOf(n.classNameMap.configId+"value")>-1?"value":t.indexOf(n.classNameMap.configId+"key")>-1?"key":void 0}function k(e,n){if(n.hasOwnProperty("width")&&(e.widthInRowSetting=parseInt(n.width)),n.hasOwnProperty("subtotalTitle")&&(e.subtotalTitleInRowSetting=n.subtotalTitle),n.hasOwnProperty("showSubtotal")){var o=n.showSubtotal;if("boolean"!=typeof o)return void a("[rowSetting.showSubtotal] wrong arguments.");e.showSubtotalInRowSetting=o}if(n.hasOwnProperty("showGrandTotal")&&(e.showGrandTotalInRowSetting=n.showGrandTotal),n.hasOwnProperty("keyRender")){var i=n.keyRender;if(!t.isFunction(i)&&null!==i)return void a("[rowSetting.keyRender] parameter should be either function or null.");e.keyRenderInRowSetting=i}}function D(e,n){if(n.hasOwnProperty("subtotalTitle")&&(e.subtotalTitleInColumnSetting=n.subtotalTitle),n.hasOwnProperty("showSubtotal")){var o=n.showSubtotal;if("boolean"!=typeof o)return void a("[columnSetting.showSubtotal] wrong arguments.");e.showSubtotalInColumnSetting=o}if(n.hasOwnProperty("showGrandTotal")&&(e.showGrandTotalInColumnSetting=n.showGrandTotal),n.hasOwnProperty("showDataKey")&&(e.showDataKeyInColumnSetting=n.showDataKey),n.hasOwnProperty("keyRender")){var i=n.keyRender;if(!t.isFunction(i)&&null!==i)return void a("[columnSetting.keyRender] parameter should be either function or null.");e.keyRenderInColumnSetting=i}n.hasOwnProperty("dragToTop")&&(e.dragToTopInColumnSetting=n.dragToTop)}function R(t,e){e.hasOwnProperty("assistButtonWidth")&&(t.assistButtonWidthInAssistSetting=e.assistButtonWidth),e.hasOwnProperty("assistHandleWidth")&&(t.assistHandleWidthInAssistSetting=e.assistHandleWidth),e.hasOwnProperty("assistTitleWidth")&&(t.assistTitleWidthInAssistSetting=e.assistTitleWidth),e.hasOwnProperty("showAssistHandle")&&(t.showAssistHandleInAreaSetting=e.showAssistHandle),e.hasOwnProperty("showAssistArea")&&(t.showAssistAreaInAreaSetting=e.showAssistArea),e.hasOwnProperty("assistButtonTitle")&&(t.assistButtonTitleInAreaSetting=e.assistButtonTitle),e.hasOwnProperty("assistButtonPosition")&&(t.assistButtonPositionInAreaSetting=null!=e.assistButtonPosition?"row"==e.assistButtonPosition?"vertical":"horizontal":null)}function O(e,n){var i="[valueSetting.";if(n.hasOwnProperty("width")&&(e.widthInValueSetting=parseInt(n.width)),n.hasOwnProperty("keyRender")){var r=n.keyRender;if(!t.isFunction(r)&&null!==r)return void a(i+"dataRender] parameter should be either function or null.");e.keyRenderInValueSetting=r}if(n.hasOwnProperty("statsRender")){var s=n.statsRender;t.isFunction(s)&&(e.statsRenderInValueSetting=s,o(i+"statsRender] set"),o(s))}if(n.hasOwnProperty("statsParser")){var l=n.statsParser;t.isFunction(l)&&(e.statsParserInValueSetting=l,o(i+"statsParser] parser set"),o(l))}if(n.hasOwnProperty("statsFunction")){var r=n.statsFunction;if(!t.isFunction(r)&&null!==r)return void a(i+"statsFunction] parameter should be either function or null.");e.statsFunctionInValueSetting=r}if(n.hasOwnProperty("columnMappingOption")){var r=n.columnMappingOption;e.statsColumnOption=r}}function I(e,n,o,a){var i;if(e.hasOwnProperty(n)){var r=e[n];i=a?t.isArray(r)?r:[r]:r}else i=o;return i}function P(e){return t(e).data(AlopexGrid.KEY_NAME+"grouper")}var K=window.__AlopexGridExportName__||"AlopexGridPivot",V=window.__AlopexGridJQueryExportName__||"alopexGridPivot",T=(window.__AlopexGridClassRoot__,null),_="groupKey";if(window.AlopexGrid&&window.AlopexGrid.release?T=window.AlopexGrid:window[window.__AlopexGridExportName__]&&window[window.__AlopexGridExportName__].release&&(T=window[window.__AlopexGridExportName__]),!(T&&function(t,e){var n,o,a=/(\.0+)+$/,i=t.replace(a,"").split("."),r=e.replace(a,"").split("."),s=Math.min(i.length,r.length);for(n=0;n<s;n++)if(o=parseInt(i[n],10)-parseInt(r[n],10))return o;return i.length-r.length}(T.release,"3.9.2")>=0))return void console.error("Alopex Pivot needs AlopexGrid above version 3.9.2.");n.release="1.0.3",n.version=n.release.split(".")[0],n.commonOption={},n.setup=function(e){return t.extend(!0,n.commonOption,e)},n.debug=!1,n.propertyNameMap={groupKey:"__grouperGroupKey",totalColumn:"__grouperGroupTotal",factKey:"__grouperFactKey",groupSumCondition:"__grouperSumCondition"},n.classNameMap={grouperRootGrid:"alopexgrid-pivot",configId:"alopexgrid-pivot-config_",configKey:"config-key-wrapper",configRow:"config-row-wrapper",configColumn:"config-column-wrapper",configValues:"config-value-wrapper",configIcon:"config-title-icon",configLayoutLeft:"pivot-column-left",configLayoutRight:"pivot-column-right",configLayoutHorize:"pivot-horizontal",groupKey:"alopexgrid-pivot-group-key",groupVertical:"alopexgrid-pivot-group-row",groupHorizontal:"alopexgrid-pivot-group-column",groupHorizontalPadding:"alopexgrid-pivot-assist-padding",pivotSubtotal:"alopexgrid-pivot-subtotal",groupValue:"alopexgrid-pivot-group-title",summaryValue:"alopexgrid-pivot-stats-value",fact:"alopexgrid-pivot-value",factsAssistColumn:"alopexgrid-pivot-assist-area-button",factsDropDown:"alopexgrid-pivot-value-dropdown",factsDropDownButton:"alopexgrid-pivot-assistbutton",factsDropDownActionButton:"alopexgrid-pivot-value-dropdown-action-button",factsDropDownSave:"alopexgrid-pivot-value-dropdown-save",factsDropDownCancel:"alopexgrid-pivot-value-dropdown-cancel",factsDropDownGridSection:"alopexgrid-pivot-value-dropdown-gridsection",factsDropDownSaveSection:"alopexgrid-pivot-value-dropdown-buttonsection",dblclickTo:"alopexgrid-pivot-keydblclickact"},n.sortingDirectionDefinition={asc:1,ascending:1,1:1,desc:-1,descending:-1,"-1":-1};var N=!1;console.log.apply&&console.error.apply||(N=!0),t.extend(n.prototype,{setGrid:function(e,n){var o=this;o.$grid=t(e),r(n)&&(o.gridOption.postGrouper=n)},addValueList:function(e,n){var o=this,a=!1;e&&(t.each(e,function(t,e){a=o.addValue(e,n)}),a&&(o.enableAllValue(),o._updateConfigData()))},clearValue:function(){var t=this;t.state.values=[],t.state.enabledValues={},t.clearUsedKey("value"),t._updateConfigData()},deleteValue:function(t){var e=this,n=e.state.values.indexOf(t),a=e.usedKeyMap;n>-1&&(e.state.values.splice(n,1),delete e.state.enabledValues[t],delete a[t],o("[values]",t,"deleted"),e._updateConfigData())},addValue:function(e,n){var i=this,r=i.state.values;return"string"!=typeof(e=t.isFunction(n)?n(e):e)?void a("[addValue]",e," parameter type is wrong."):i.isGroupKey(e)?void(i.isValue(e)||(r.push(e),i.isValueEnabled(e)||i.enableValue(e),o("[Values]",e,"added"),i.isColumn(e)?i.deleteColumn(e):i.isRow(e)&&i.deleteRow(e),i._updateConfigData())):void a("[addValue]",e," is not included in KeyMapping.")},insertValueBefore:function(e,n){var a=this,i=null,r=null;null!=e&&(null!=n&&a.isValue(n)&&(r=t.inArray(n,a.state.values)),a.isValue(e)&&(i=t.inArray(e,a.state.values)),null!=i&&null!=r&&i<r&&r--,null!=i&&a.deleteValue(e),null==r?a.addValue(e):(a.state.values.splice(r,0,e),o("[Values] "+e+" added at "+r),a._updateConfigData()))},isValue:function(e){var n=this;return!!(n.state.values&&t.inArray(e,n.state.values)>=0)},isValueEnabled:function(t){var e=this;return!(!e.state.enabledValues||!0!==e.state.enabledValues[t])},enableValue:function(e){var n=this;if(arguments.length>1)return void t.each(arguments,function(t,e){n.enableValue(e)});n.isValue(e)?(n.state.enabledValues[e]=!0,o("[Values]",e,"enabled")):a("values has no key named",e)},disableValue:function(e){var n=this;if(arguments.length>1)return void t.each(arguments,function(t,e){n.disableValue(e)});n.isValue(e)&&delete this.state.enabledValues[e]},enableAllValue:function(){var e=this,n=e.state.values;n&&t.each(n,function(t,n){e.enableValue(n)})},disableAllValue:function(){this.state.enabledValues={}},setValueStatsRenderer:function(e,n){t.isFunction(e)&&(this.state.statsRenderInValueSetting=e,o("[statsRenderInValueSetting] set"),o(e)),t.isFunction(n)&&(this.state.statsParserInValueSetting=n,o("[statsRenderInValueSetting] parser set"),o(n))},setKeyStatsRenderer:function(e,n,a){e&&t.isFunction(n)&&(this.state.statsRenderMap[e]=n,o("[setKeyStatsRenderer] renderer for "+e+" set"),o(n)),e&&t.isFunction(a)&&(this.state.statsParserMap[e]=a,o("[setKeyStatsRenderer] parser for "+e+" set"),o(a))},getStatsRender:function(t){return this.state.statsRenderMap[t]||this.state.statsRenderInValueSetting||s},getStatsParser:function(t){return this.state.statsParserMap[t]||this.state.statsParserInValueSetting||s},setValueStatsFunction:function(e){if(!t.isFunction(e)&&null===e)return void a("[setValueStatsFunction] parameter should be either function or null.");this.state.statsFunctionInValueSetting=e},setKeyStatsFunction:function(e,n,o){return e?t.isFunction(n)||null!==n?(this.state.statsFunctionMap[e]=n,void("boolean"==typeof o&&(n.paramIsData=o))):void a("[setKeyStatsFunction] parameter should be either function or null."):void a("[setKeyStatsFunction] no key provided.")},getStatsFunction:function(t){return this.state.statsFunctionMap[t]||this.state.statsFunctionInValueSetting},getValueWidth:function(t){return this.state.columnWidthMap[t]||this.state.widthInValueSetting},getWidth:function(t){return this.isValue(t)?this.getValueWidth(t):this.isRow(t)?this.getRowWidth(t):this.state.columnWidthMap[t]||null},getKeyStatsClass:function(t,e){var n=this.state.statsClassMap[t],o=typeof n;return"number"===o||"string"===o?n:"function"===o?n(e):null},setGroupKeys:function(t){var e=this;e.clearGroupKeys(),e.addGroupKeys(t)},addGroupKeys:function(e){if(e){var n=this;t.each(e,function(t,e){n.addGroupKey(e)})}},addGroupKey:function(t){this.isGroupKey(t)||(this.state.groupKeys.push(t),this.setSorting(t,this.option.defaultSortingDirection),o("[groupKey]",t,"added"))},deleteGroupKey:function(t){this.isGroupKey(t)&&(this.state.groupKeys.splice(this.getGroupKeyIndex(t),1),this.deleteSorting(t),o("[groupKey]",t,"deleted"))},clearGroupKeys:function(){this.state.groupKeys=[],this.state.groupSortingMap={}},isGroupKey:function(e){return!!(this.state.groupKeys&&t.inArray(e,this.state.groupKeys)>=0)},getGroupKeyIndex:function(e){return t.inArray(e,this.state.groupKeys)},getKeyRender:function(t,e){return this.isGroupKey(t)?null!=this.state.keyRenderMap[t]?"function"==typeof this.state.keyRenderMap[t]?this.state.keyRenderMap[t](t):this.state.keyRenderMap[t]:this.isRow(t)&&"function"==typeof this.state.keyRenderInRowSetting?this.state.keyRenderInRowSetting(t):this.isColumn(t)&&"function"==typeof this.state.keyRenderInColumnSetting?this.state.keyRenderInColumnSetting(t):this.isValue(t)&&"function"==typeof this.state.keyRenderInValueSetting?this.state.keyRenderInValueSetting(t):!this.isGroupKey(t)||"function"!=typeof this.option.keyRenderHidden||!0!==e&&this.usedKeyMap[t]?"function"==typeof this.option.keyRender?this.option.keyRender(t):t:this.option.keyRenderHidden(t):(a("[getKeyRener] "+t+"is not included in keyMapping"),!1)},getDataRender:function(t,e){return this.state.dataRenderMap[t]?"function"==typeof this.state.dataRenderMap[t]?this.state.dataRenderMap[t](e):this.state.dataRenderMap[t]:"function"==typeof this.option.dataRender?this.option.dataRender(e):e},setStatsColumnOption:function(e,n){var o=this;"string"==typeof e?t.isPlainObject(n)||t.isFunction(n)?o.state.statsColumnOptionMap[e]=n:null===n&&(o.state.statsColumnOptionMap[e]={}):1===arguments.length&&(t.isPlainObject(e)?o.state.statsColumnOption=e:null===e&&(o.state.statsColumnOption={}))},extendStatsColumnOption:function(e,n){t.extend(e,this.state.statsColumnOption),this.isValue(n)&&(t.isFunction(this.state.statsColumnOptionMap[n])?this.state.statsColumnOptionMap[n].call(this,e):t.extend(e,this.state.statsColumnOptionMap[n]))},isRow:function(e){return t.inArray(e,this.state.rows)>=0},getRowIndex:function(e){return t.inArray(e,this.state.rows)},addRow:function(t){var e=this;this.isGroupKey(t)&&!this.isRow(t)?(this.state.rows.push(t),e.isValue(t)?e.deleteValue(t):e.isColumn(t)&&e.deleteColumn(t),e._updateConfigData(),o("[Row] "+t+" added")):a('[Row] "'+t+'" add failed. "'+t+'" is not in keyMapping')},deleteRow:function(e){var n=this,o=n.usedKeyMap;n.isRow(e)&&(n.state.rows.splice(t.inArray(e,this.state.rows),1),"row"==o[e]&&delete o[e],n._updateConfigData())},insertRowBefore:function(e,n){var a=this,i=null,r=null;null!=e&&(null!=n&&a.isRow(n)&&(r=t.inArray(n,a.state.rows)),a.isRow(e)&&(i=t.inArray(e,a.state.rows)),null!=i&&null!=r&&i<r&&r--,null!=i&&a.deleteRow(e),null==r?a.addRow(e):(a.state.rows.splice(r,0,e),a._updateConfigData(),o("[Row] "+e+" added at "+r)))},setRow:function(e){var n=this;e&&t.isArray(e)&&e.length&&(n.clearRow(),t.each(e,function(t,e){n.addRow(e)}),n._updateConfigData())},getLastRow:function(){var t=null;return i(this.state.rows)&&(t=this.state.rows[this.state.rows.length-1]||null),t},clearRow:function(){var t=this;t.state.rows=[],t.clearUsedKey("row"),t._updateConfigData()},getRowWidth:function(t){return this.state.columnWidthMap[t]||this.state.widthInRowSetting},setRowWidth:function(t,e){this.state.columnWidthMap[t]=parseInt(e)},isRowSubtotalVisible:function(t){var e=this.state.showSubtotalMap[t];return"boolean"==typeof e?e:this.state.showSubtotalInRowSetting},setRowSubtotalVisible:function(e,n){var o=this;"boolean"==typeof e?(this.state.showSubtotalInRowSetting=e,t.each(this.state.showSubtotalMap,function(t,n){o.state.showSubtotalMap[t]=e})):"string"==typeof e&&"boolean"==typeof n?this.state.showSubtotalMap[e]=n:a("[setRowSubtotalVisible] wrong arguments.")},getRowSubtotalTitle:function(t){var e=this;return e.state.subtotalTitleMap[t]||e.state.subtotalTitleInRowSetting},getRowVisibleSubtotalList:function(){for(var t=[],e=0,n=this.state.rows.length;e<n;e++)(this.isRowSubtotalVisible(this.state.rows[e])||e===n-1)&&t.push(this.state.rows[e]);return t},getRowVisibleMapForFolded:function(){for(var t={},e=0,n=this.state.rows.length-1;e<n;e++)this.isRowSubtotalVisible(this.state.rows[e])||(t[this.state.rows[e]]=!0);return t},isColumn:function(e){return t.inArray(e,this.state.columns)>=0},addColumn:function(t){var e=this;this.isGroupKey(t)&&!this.isColumn(t)?(this.state.columns.push(t),e.isValue(t)?e.deleteValue(t):e.isRow(t)&&e.deleteRow(t),o("[Column] "+t+" added"),e._updateConfigData()):a('[Column] "'+t+'" add failed. "'+t+'" is not in keyMapping.')},moveColumnToFirst:function(t){var e=this;e.isGroupKey(t)&&!e.isColumn(t)?(e.state.columns.unshift(t),e._updateConfigData(),o("[Column] "+t+" moveColumnToFirst")):a('[Column] "'+t+'" moveColumnToFirst failed. "'+t+'" is not in groupkeys.')},deleteColumn:function(e){var n=this,o=n.usedKeyMap;n.isColumn(e)&&(n.state.columns.splice(t.inArray(e,this.state.columns),1),"column"==o[e]&&delete o[e],n._updateConfigData())},insertColumnBefore:function(e,n){var a=this,i=null,r=null;null!=e&&(null!=n&&a.isColumn(n)&&(r=t.inArray(n,a.state.columns)),a.isColumn(e)&&(i=t.inArray(e,a.state.columns)),null!=i&&null!=r&&i<r&&r--,null!=i&&a.deleteColumn(e),null==r?a.addColumn(e):(a.state.columns.splice(r,0,e),a._updateConfigData(),o("[Column] "+e+" added at "+r)))},setColumn:function(e){var n=this;e&&t.isArray(e)&&e.length&&(n.clearColumn(),t.each(e,function(t,e){n.addColumn(e)}),n._updateConfigData())},getLastColumn:function(){var t=null;return i(this.state.columns)&&(t=this.state.columns[this.state.columns.length-1]||null),t},clearColumn:function(){var t=this;t.state.columns=[],t.clearUsedKey("column"),t._updateConfigData()},isColumnSubtotalVisible:function(t){var e=this.state.showSubtotalMap[t];return"boolean"==typeof e?e:this.state.showSubtotalInColumnSetting},setColumnSubtotalVisible:function(e,n){var o=this;"boolean"==typeof e?(this.state.showSubtotalInColumnSetting=e,t.each(this.state.showSubtotalMap,function(t,n){o.state.showSubtotalMap[t]=e})):"string"==typeof e&&"boolean"==typeof n?this.state.showSubtotalMap[e]=n:a("[setColumnSubtotalVisible] wrong arguments.")},setSubtotalVisible:function(e,n){var o=this;"boolean"==typeof e?(o.state.showSubtotalInColumnSetting=e,o.state.showSubtotalInRowSetting=e,t.each(this.state.showSubtotalMap,function(t,n){o.state.showSubtotalMap[t]=e})):"string"==typeof e&&"boolean"==typeof n?this.state.showSubtotalMap[e]=n:a("[setSubtotalVisible] wrong arguments.")},getColumnSubtotalTitle:function(t){return this.state.subtotalTitleMap[t]||this.state.subtotalTitleInColumnSetting},getSubtotalTitle:function(t){return this.isRow(t)?this.getRowSubtotalTitle(t):this.isColumn(t)?this.getColumnSubtotalTitle(t):this.state.subtotalTitleMap[t]||null},isSubtotalVisible:function(t){return this.isRow(t)?this.isRowSubtotalVisible(t):!!this.isColumn(t)&&this.isColumnSubtotalVisible(t)},toggleSubtotalVisible:function(t){var e=this.isSubtotalVisible(t);this.isRow(t)?this.setRowSubtotalVisible(t,!e):this.isColumn(t)&&this.setColumnSubtotalVisible(t,!e)},setSorting:function(t,e){t&&this.isGroupKey(t)&&(this.state.groupSortingMap[t]=n.sortingDirectionDefinition[String(e||"").toLowerCase()]||n.sortingDirectionDefinition[this.option.defaultSortingDirection])},toggleSorting:function(t){t&&this.isGroupKey(t)&&(this.state.groupSortingMap[t]=-1*(this.state.groupSortingMap[t]||-1))},deleteSorting:function(e){var n=this;if(arguments.length>1)return void t.each(t.makeArray(arguments),function(t,e){n.option.deleteSorting[e]});delete n.state.groupSortingMap[e]},_isSorting:function(t){return this.state.groupSortingMap[t]||0},isSorting:function(t){return!!this.state.groupSortingMap[t]},getSorting:function(){var e=this;return t.map(this.state.groupSortingMap,function(t,n){if(t&&(e.isRow(n)||e.isColumn(n)))return{groupKey:n,sorting:t}}).sort(function(n,o){var a=n.groupKey,i=o.groupKey;return e.isRow(a)&&e.isColumn(i)?-1:e.isColumn(a)&&e.isRow(i)?1:e.isRow(a)&&e.isRow(i)?t.inArray(a,e.state.rows)-t.inArray(i,e.state.rows):e.isColumn(a)&&e.isColumn(i)?t.inArray(a,e.state.columns)-t.inArray(i,e.state.columns):!e.isRow(a)&&!e.isColumn(a)||e.isRow(i)||e.isColumn(i)?e.isRow(a)||e.isColumn(a)||!e.isRow(i)&&!e.isColumn(i)?0:1:-1})},setData:function(e){var n=this;e&&(t.isPlainObject(e)&&(e=[e]),o("[setData] length : "+e.length),n.option.data=e)},sortData:function(){var t=this;if(!t.option.data)return void err("[sortData] no data to sort.");var e=t.state.rows.length;t.option.data.sort(function(n,o){for(var a=0;a<e;a++){var i=t.state.rows[a],r=n[i],s=o[i];if(void 0!=r&&null!=r||(r=""),void 0!=s&&null!=s||(s=""),r!==s){if(r<s)return-1*t._isSorting(i);if(r>s)return 1*t._isSorting(i)}}return 0})},getFilterOption:function(t){if(!this.$grid)return null;({})[n.propertyNameMap.groupKey]=t;var e=this.$grid.alopexGrid("columnInfo",t);return e?e.filterOption||null:null},saveFilterOption:function(){this.preFilteredColumn=[];for(var t=this.$grid.alopexGrid("readOption").columnMapping,e=0,n=t.length;e<n;e++)t[e].filterOption&&this.preFilteredColumn.push({key:t[e].key,filterOption:t[e].filterOption})},restoreFilterOption:function(){var e=this;if(this.preFilteredColumn.length>0){var n=this.preFilteredColumn,o=this.$grid;t.each(n,function(t,a){var i=n[t].key;if(e.isRow(i)){var r=n[t].filterOption;o.alopexGrid("updateColumn",{filterOption:r},i)}})}},generateColumn:function(){var e=this,a=[],i=[],r=null,s={},w=[],x=[];if(e.$grid.alopexGrid("updateOption",{hiddenColumnOrderList:[]}),t.each([].concat(e.state.rows).concat(e.state.columns).concat(e.state.groupKeys),function(t,i){if(t===e.state.rows.length&&a.push({id:"__verticalHorizontalBar__",hidden:"conceal"}),!s[i]){s[i]=!0;var r={};r.id=i,r.key=i,r.render=function(t){return e.getDataRender(i,t)},r.title=e.getKeyRender(i),r.sorting=!0,r[n.propertyNameMap.groupKey]=i,e.getLastRow()!==i&&e.isRow(i)&&(r.groupFoldingColumn=!0),r.groupFooter=e.getRowSubtotalTitle(i),r.groupFooterStyleclass=n.classNameMap.pivotSubtotal,r.headerDragDrop=!0,r.headerStyleclass=n.classNameMap.groupKey,r.styleclass="",e.isRow(i)?(r.headerStyleclass+=" "+n.classNameMap.groupVertical,r.styleclass+=n.classNameMap.groupValue+" "+n.classNameMap.groupVertical):e.isColumn(i)&&(r.headerStyleclass+=" "+n.classNameMap.groupHorizontal,r.styleclass+=" "+n.classNameMap.groupHorizontal),r.width=e.getRowWidth(i),r.rowspan=!0,r.colspanTo=function(t,n,o,a){if(a&&a.groupDepth<e.getRowIndex(i))return e.getLastRow()},r.hidden=!1,e.option.keyDblClickAct&&(r.headerStyleclass+=" "+n.classNameMap.dblclickTo),e.isRow(i)?(w.push(r),r.resizing=!0):(r.width=0,r.render=C,e.isColumn(i)?(r.width=e.state.assistHandleWidthInAssistSetting,!0===e.state.showAssistAreaInAreaSetting&&!0===e.state.showAssistHandleInAreaSetting?(r.title=function(t){return t.hidden?e.getKeyRender(t[n.propertyNameMap.groupKey],t.hidden):""},r.rowspan=!1,r.colspanTo=null,r.groupFooter=null,r.headerStyleclass+=" "+n.classNameMap.groupHorizontal,x.push(r)):r.hidden="conceal"):e.isValue(i)?r.hidden="conceal":(r.hidden=!0,r.title=e.getKeyRender(i,r.hidden))),a.push(r),o("[generateColumn] "+i+" column created. (hidden : :"+(r.hidden||!1)+")")}}),i.push({columnIndex:w[0].key,render:function(){return e.getRowSubtotalTitle(w[0][n.propertyNameMap.groupKey])||""},colspanTo:w[w.length-1].key}),!0===e.state.showAssistAreaInAreaSetting){var b=Math.max(e.state.assistHandleWidthInAssistSetting*e.state.columns.length,e.state.assistTitleWidthInAssistSetting),A={};A.title="",A.styleclass=n.classNameMap.factsAssistColumn,A.headerStyleclass=[n.classNameMap.groupHorizontal,n.classNameMap.groupHorizontalPadding,n.classNameMap.factsAssistColumn].join(" "),"horizontal"===e.state.assistButtonPositionInAreaSetting&&(A.title=e.state.assistButtonTitleInAreaSetting,A.headerStyleclass+=" "+n.classNameMap.factsDropDownButton),A.id=e.state.columns.join("")+"__padding",!0===e.state.showAssistHandleInAreaSetting?A.width=Math.max(b-e.state.columns.length*e.state.assistHandleWidthInAssistSetting,e.state.assistButtonWidthInAssistSetting):A.width=e.state.assistTitleWidthInAssistSetting,x.push(A),a.push(A)}var G=e.option.tree=l(null);e.option.data&&e.option.data.length&&t.each(e.option.data,function(n,o){var a=G;t.each(e.state.columns,function(t,e){var n=o[e],i=y(a,n);i||(i=l(n,{key:e}),u(a,i)),a=i})}),v(G,function(t){var n=c(t).key,o=!0;t===G?e.state.showGrandTotalInColumnSetting||(o=!1):f(t)?o=!1:e.isColumnSubtotalVisible(n)||(o=!1),o&&u(t,l(null,{total:!0,key:n||null,subtotal:!0}))}),r=function o(r){var s=[],l={};if(l.title=c(r).total?e.getColumnSubtotalTitle(c(g(r)).key):e.getDataRender(c(r).key,p(r)),l[n.propertyNameMap.groupKey]=c(r).key,l[n.propertyNameMap.totalColumn]=!!c(r).total,l.headerStyleclass=n.classNameMap.groupValue,f(r)){if(r!==G||e.state.showGrandTotalInColumnSetting){var u=[];t.each(e.state.values,function(o,a){if(e.isValueEnabled(a)){var s={};s.id=t.map(m(r).concat([r]),function(t){return p(t)}).join("")+a,s.key=a,s.title=e.getKeyRender(a),s.width=e.getValueWidth(a),s.render=e.getStatsRender(a),s.align="right",s.headerStyleclass=n.classNameMap.fact,s.styleclass=n.classNameMap.summaryValue,s.groupFooterAlign="right";var l=e.getStatsRender(a),d=e.getStatsParser(a);s.groupFooter=function(t,o){var a=o[n.propertyNameMap.groupSumCondition]||{},i=t.member,r=e.getStatsFunction(o[n.propertyNameMap.factKey]),s=r?r(M(this,i,o[n.propertyNameMap.factKey],a,r.paramIsData)):S(this,i,o[n.propertyNameMap.factKey],a);return l(s)},s.groupFooterStyleclass=function(t,o,i,s){var l=Object.keys(e.$grid.data(AlopexGrid.KEY_NAME).state.groupKeyOrderMap).length-1;return c(r).subtotal?n.classNameMap.pivotSubtotal:s&&s.groupDepth!=l?n.classNameMap.pivotSubtotal:e.state.statsClassMap[a]?e.getKeyStatsClass(a,d(t)):void 0},s[n.propertyNameMap.factKey]=a,s[n.propertyNameMap.groupSumCondition]={},s[n.propertyNameMap.totalColumn]=!!c(r).total;var g=m(r);c(r).total||g.push(r),t.each(g,function(t,e){h(e)||null==c(e).key||(s[n.propertyNameMap.groupSumCondition][c(e).key]=p(e))}),e.extendStatsColumnOption(s,a),u.push(s);var f={};f.columnIndex=s.id,f.align="right",f.render=[function(t){var o=e.getStatsFunction(s[n.propertyNameMap.factKey]);return e.getStatsRender(a)(o?o(M(this,t,s[n.propertyNameMap.factKey],s[n.propertyNameMap.groupSumCondition],o.paramIsData)):S(this,t,s[n.propertyNameMap.factKey],s[n.propertyNameMap.groupSumCondition]))}],f.styleclass=function(t,n,o){return e.getKeyStatsClass(a,d(t))},i.push(f)}}),u.length&&(l.fromIndex=u[0].id,l.toIndex=u[u.length-1].id,a=a.concat(u))}}else{var w=[].concat(d(r)),y=e._isSorting(c(w[0]).key);w.sort(function(t,e){return c(t).total?1:c(e).total?-1:p(t)<p(e)?-1*y:p(t)>p(e)?1*y:0}),t.each(w,function(t,e){s=s.concat(o(e))}),s.length&&(l.fromIndex=s[0].fromIndex,l.toIndex=s[s.length-1].toIndex)}return h(r)||s.unshift(l),s}(G);var k=r.length?r[0].fromIndex:null,D=r.length?r[r.length-1].toIndex:null;return!0!==e.state.showAssistAreaInAreaSetting&&!0!==e.state.showDataKeyInColumnSetting||(r=t.map(e.state.columns,function(t,o){var a={};return a.title=e.getKeyRender(t),a[n.propertyNameMap.groupKey]=t,a.headerStyleclass=[n.classNameMap.groupKey,n.classNameMap.groupHorizontal].join(" "),e.option.keyDblClickAct&&(a.headerStyleclass+=" "+n.classNameMap.dblclickTo),!0===e.state.showAssistAreaInAreaSetting?(a.fromIndex=(x[o]||x[0]).id,x[o]&&x[o][n.propertyNameMap.groupKey]&&!x[o].hidden&&(a.fromIndex=x[o][n.propertyNameMap.groupKey])):a.fromIndex=k,
!0===e.state.showDataKeyInColumnSetting?a.toIndex=D:a.toIndex=x[x.length-1].id,a}).concat(r)),"vertical"===e.state.assistButtonPositionInAreaSetting&&r.push({fromIndex:e.state.rows[0],toIndex:e.state.rows[0],title:e.state.assistButtonTitleInAreaSetting,headerStyleclass:n.classNameMap.factsDropDownButton}),o("[horizontal tree]"),o(G),o("[columnMapping]"),o(a),o("[headerGroup]"),o(r),o("[footerMapping]"),o(i),{columnMapping:a,footerMapping:i,headerGroup:r,verticalColumnMapping:w,horizontalColumnMapping:x}},attachValueDropDown:function(e,a){var i=this;if(!this.isValueDropDown()){var r=(new Date).getTime().toString()+Math.floor(1e3*Math.random()).toString();this.$dropdown=t("<div></div>").addClass(n.classNameMap.factsDropDown).attr("data-timestamp",r).appendTo(document.body).css({left:e+"px",top:a+"px"});var s=t("<div>").addClass(n.classNameMap.factsDropDownGridSection).appendTo(this.$dropdown);t("<div>").appendTo(s).alopexGrid(t.extend(!0,{},i.option.gridOption.preFact,{height:"content",width:"content",autoColumnIndex:!0,headerRowHeight:this.rowHeight,disableTextSelection:!0,rowOption:{defaultHeight:this.rowHeight},rowClickSelect:!0,rowSingleSelect:!1,rowInlineEdit:!1,cellInlineEdit:!1,rowPadding:!1,header:!1,scrollbarPreview:{enabled:!1},lazyScroll:{enabled:!1},grouping:{useGrouping:!1},columnMapping:[{selectorColumn:!0,width:20},{key:"factTitle",width:80,title:"Fact"}],data:t.map(this.state.values,function(t){return{factTitle:i.getKeyRender(t),fact:t,_state:{selected:i.isValueEnabled(t)}}})},i.option.gridOption.afterFact)).on("dataSelect",function(t){AlopexGrid.parseEvent(t)});var l=t("<div>").addClass(n.classNameMap.factsDropDownSaveSection).appendTo(this.$dropdown);t('<button type="button">'+AlopexGrid.i18n("save")+"</button>").addClass(n.classNameMap.factsDropDownSave+" "+n.classNameMap.factsDropDownActionButton).appendTo(l).click(function(){var t=i.saveValueDropDown();t&&(i.removeValueDropDown(),t&&i.render())}),t('<button type="button">'+AlopexGrid.i18n("close")+"</button>").addClass(n.classNameMap.factsDropDownCancel+" "+n.classNameMap.factsDropDownActionButton).appendTo(l).click(function(){i.removeValueDropDown()}),this.$dropdown.attr("data-signature",this.getValueDropDownSignature()),t(document).on("mousedown."+r,function(e){t(e.target).closest(i.$dropdown).length||i.removeValueDropDown()}),o("[factsDropDown] opened")}},saveValueDropDown:function(){var e=this;if(!this.isValueDropDown())return!1;if(this.$dropdown.attr("data-signature")!=this.getValueDropDownSignature()){var n=this.$dropdown.find(".alopexgrid"),i=n.alopexGrid("dataGet",{_state:{selected:!0}});return i&&i.length?(t.each(n.alopexGrid("dataGet"),function(t,n){var o={};if(n._state.selected)if(e.addValue(n.fact),1==e.state.configFlag){o[_]=n.fact;var a=e.$value.alopexGrid("dataGet",o);0==a.length&&(o[_]=n.fact,e.$key.alopexGrid("rowSelect",o,!0),e.$value.alopexGrid("dataAdd",o))}else e.enableValue(n.fact);else 1==e.state.configFlag?(e.deleteValue(n.fact),o[_]=n.fact,e.$value.alopexGrid("dataDelete",o),e.$key.alopexGrid("rowSelect",o,!1)):e.disableValue(n.fact)}),o("[valueDropDownn] saved"),!0):(a("[valueDropDownn] no values selected. cancel."),!1)}return!1},removeValueDropDown:function(){this.isValueDropDown()&&(t(document).off("."+this.$dropdown.attr("data-timestamp")),this.$dropdown.find(".alopexgrid").removeAlopexGrid(),this.$dropdown.remove(),this.$dropdown=null,o("[valueDropDownn] removed"))},getValueDropDownSignature:function(){return t.map(this.$dropdown.find(".alopexgrid").alopexGrid("dataGet"),function(t){return t._index.row+t.fact+t._state.selected}).join("")},isValueDropDown:function(){return!(!this.$dropdown||!this.$dropdown.length)},prepareEventHandler:function(){function t(t,e){return!(!e.leftColumnMapping||!t.isRow(e.leftColumnMapping.key))||!(!e.rightColumnMapping||!t.isRow(e.rightColumnMapping.key))}function e(t,e){return!(!e.leftColumnMapping||!t.isColumn(e.leftColumnMapping.key))||!(!e.rightColumnMapping||!t.isColumn(e.rightColumnMapping.key))}var i=".AlopexGridGROUPEREventHandler";this.$grid.off(i),this.$grid.on("hiddenHeaderDragOver"+i+" headerDragOver"+i,{self:this},function(e){var o=e.data.self,a=AlopexGrid.parseEvent(e),i=a.dragColumnMapping,r=i[n.propertyNameMap.groupKey];if(a.toHiddenColumnArea){if(o.isRow(r)&&o.state.rows.length<2)return!1;if(o.isColumn(r)&&o.state.columns.length<1)return!1}else{if(o.isRow(r)&&o.state.rows.length<2&&!t(o,a))return!1;if(o.isColumn(r)&&o.state.columns.length<1&&t(o,a))return!1}}),this.$grid.on("hiddenHeaderDragDrop"+i+" headerDragDrop"+i,{self:this},function(a){var i=a.data.self,r=AlopexGrid.parseEvent(a),s=r.dropColumnMapping;if(s){var l=s[n.propertyNameMap.groupKey],u=!1;if(r.toHiddenColumnArea){if("hiddenHeaderDragDropEnd"===a.type)return;i.isRow(l)&&i.state.rows.length>1&&(u=!0),i.isColumn(l)&&i.state.columns.length>0&&(u=!0)}else u=!(t(i,r)||!e(i,r))||(t(i,r),!0);u&&(i.saveFilterOption(),i.__preemptied=!0,i.$grid.alopexGrid("dataEmpty"),o("[drag] pre-dataEmpty processed."))}}),this.$grid.on("hiddenHeaderDragDropEnd"+i+" headerDragDropEnd"+i,{self:this},function(a){var i=a.data.self,r=i.usedKeyMap,s=AlopexGrid.parseEvent(a),l=s.dropColumnMapping;s.leftColumnMapping,s.rightColumnMapping;if(l){var u=l[n.propertyNameMap.groupKey];if({}[_]=u,s.toHiddenColumnArea){if("hiddenHeaderDragDropEnd"===a.type)return;i.isRow(u)&&i.state.rows.length>1&&(i.deleteRow(u),delete r[u],o("[drag] Row "+u+" removed.")),i.isColumn(u)&&i.state.columns.length>0&&(i.deleteColumn(u),delete r[u],o("[drag] Column "+u+" removed."))}else if(!t(i,s)&&e(i,s))(r[u]&&"column"!=r[u]||!i.state.configFlag)&&(i.deleteRow(u),r[u]="column"),i.insertColumnBefore(u,s.rightColumnMapping?s.rightColumnMapping[n.propertyNameMap.groupKey]:null),o("[drag] "+u+" position changed");else if(t(i,s))(r[u]&&"row"!=r[u]||!i.state.configFlag)&&(i.deleteColumn(u),r[u]="row"),i.insertRowBefore(u,s.rightColumnMapping?s.rightColumnMapping[n.propertyNameMap.groupKey]:null),o("[drag] "+u+" added to Row.");else{i.state.dragToTopInColumnSetting?i.moveColumnToFirst(u):i.addColumn(u);i.state.dragToTopInColumnSetting;(r[u]&&"column"!=r[u]||!i.state.configFlag)&&(i.deleteRow(u),r[u]="column"),o("[drag] "+u+" added to Column.")}i.render(function(){i.__preemptied=!1})}}),this.$grid.on("dblclick"+i,".headercell."+n.classNameMap.dblclickTo,{self:this},function(t){if(!AlopexGrid.renderUtil.isGridPointerActionProhibited(t.target)){var e=t.data.self,i=e.usedKeyMap,r=AlopexGrid.parseEvent(t),s=parseInt(r.$cell.attr("data-alopexgrid-columndepth"),0),l=r.mapping,u=null;r.$cell.hasClass("header-group")&&null==u&&!isNaN(s)?u=e.state.columns[s]:l&&l[n.propertyNameMap.groupKey]&&(u=l[n.propertyNameMap.groupKey]);if({}[_]=u,u){var p=!1;if(e.isRow(u)&&"remove"===e.option.keyDblClickAct&&e.state.rows.length<2)return void a("[keyDblClickAct] only 1 Row left. remove aborted.");e.isRow(u)?("switch"!==e.option.keyDblClickAct&&"remove"!==e.option.keyDblClickAct||(e.deleteRow(u),delete i[u],o("[keyDblClickAct] Row "+u+" removed."),p=!0),"switch"===e.option.keyDblClickAct&&(e.addColumn(u),i[u]="column",o("[keyDblClickAct] Column "+u+" added."),p=!0)):e.isColumn(u)&&("switch"!==e.option.keyDblClickAct&&"remove"!==e.option.keyDblClickAct||(e.deleteColumn(u),delete i[u],o("[keyDblClickAct] Column "+u+" removed."),p=!0),"switch"===e.option.keyDblClickAct&&(e.addRow(u),i[u]="row",o("[keyDblClickAct] Row "+u+" added."),p=!0)),p&&e.render()}}}),this.removeValueDropDown(),this.$grid.on("click"+i,".headercell."+n.classNameMap.factsDropDownButton,{self:this},function(t){var e=t.data.self,n=AlopexGrid.parseEvent(t);return o("[factsDropDownButton] clicked."),e.isValueDropDown()?e.removeValueDropDown():e.attachValueDropDown(n.$cell.offset().left,n.$cell.offset().top+n.$cell.outerHeight()),!1}),this.$grid.on("sortToggle"+i,{self:this},function(t){var e=t.data.self,o=AlopexGrid.parseEvent(t);if(e.isGroupKey(o.mapping[n.propertyNameMap.groupKey]))return e.toggleSorting(o.mapping[n.propertyNameMap.groupKey]),e.render(),!1}),this.$grid.on("UIColumnResizeEnd"+i,{self:this},function(t){var e=t.data.self,o=AlopexGrid.parseEvent(t),a=o.mapping,i=o.width;e.isRow(a[n.propertyNameMap.groupKey])&&e.setRowWidth(a[n.propertyNameMap.groupKey],i)})},getContextMenuItems:function(){function e(t,e){var o=null;return e.attr("data-alopexgrid-headergroupid")?o=t.headerGroupInfo(e.attr("data-alopexgrid-headergroupid")):e.attr("data-alopexgrid-columnindex")&&(o=t.columnInfo(e.attr("data-alopexgrid-columnindex"))),o&&o.hasOwnProperty(n.propertyNameMap.groupKey)&&e.hasClass("headercell")?o:null}function o(o,a){var r=e(o,a);return r&&r[n.propertyNameMap.totalColumn]?r[n.propertyNameMap.groupKey]?i.state.columns[t.inArray(r[n.propertyNameMap.groupKey],i.state.columns)+1]:i.state.columns[0]:r&&r[n.propertyNameMap.groupKey]?r[n.propertyNameMap.groupKey]:null}function a(e){return i.isRow(e)?i.state.rows[t.inArray(e,i.state.rows)-1]||null:i.isColumn(e)?i.state.columns[t.inArray(e,i.state.columns)-1]||null:null}var i=this;!function(){i.contextMenuTitle={hideGroupSummary:AlopexGrid.i18n("hideGroupSummary"),showGroupSummary:AlopexGrid.i18n("showGroupSummary"),sortAscending:AlopexGrid.i18n("sortAscending"),sortDescending:AlopexGrid.i18n("sortDescending"),showFilterDropdown:AlopexGrid.i18n("showFilterDropdown"),showHorizontalColumn:AlopexGrid.i18n("showHorizontalColumn"),hideHorizontalColumn:AlopexGrid.i18n("hideHorizontalColumn"),showHorizontalDragColumn:AlopexGrid.i18n("showHorizontalDragColumn"),hideHorizontalDragColumn:AlopexGrid.i18n("hideHorizontalDragColumn"),showFactsDropDown:AlopexGrid.i18n("showFactsDropDown")}}();var r=[];return r.push({use:function(t,n,o){return i.option.contextMenuOn.showSubtotal&&!!e(o,n)},title:function(t,e,n){var r=o(n,e),s=!1,l=a(r);return l?s=i.isSubtotalVisible(l):i.isRow(r)?s=i.state.showGrandTotalInRowSetting:(i.isColumn(r)||e.hasClass("headercell"))&&(s=i.state.showGrandTotalInColumnSetting),s?i.option.contextMenuTitle.hideSubtotal:i.option.contextMenuTitle.showSubtotal},processor:function(t,e,n){var r=o(n,e),s=a(r);s?i.toggleSubtotalVisible(s):i.isRow(r)?i.state.showGrandTotalInRowSetting=!i.state.showGrandTotalInRowSetting:(i.isColumn(r)||e.hasClass("headercell"))&&(i.state.showGrandTotalInColumnSetting=!i.state.showGrandTotalInColumnSetting),i.render()}}),r.push({use:function(t,e,n){return i.option.contextMenuOn.showSubtotal&&!i.state.columns.length&&!e.length&&!i.state.showGrandTotalInColumnSetting},title:function(t,e,n){return i.state.showGrandTotalInColumnSetting?i.option.contextMenuTitle.hideSubtotal:i.option.contextMenuTitle.showSubtotal},processor:function(t,e,n){i.state.showGrandTotalInColumnSetting=!i.state.showGrandTotalInColumnSetting,i.render()}}),r.push({use:function(t,n,o){return i.option.contextMenuOn.sort&&!!e(o,n)},title:function(t,e,n){var a=o(n,e);return[i.option.contextMenuTitle.sortAscending,i.option.contextMenuTitle.sortDescending][i._isSorting(a)>0?1:0]},processor:function(t,e,n){var a=o(n,e);i.toggleSorting(a),i.render()}}),r.push({use:function(t,o,a){var r=e(a,o);if(!r)return!1;var s=r[n.propertyNameMap.groupKey];return i.option.contextMenuOn.filterDropdown&&!(!s||!i.isRow(s))},title:function(t,e,n){return i.option.contextMenuTitle.showFilterDropdown},processor:function(t,o,a){var i=e(a,o),r=i[n.propertyNameMap.groupKey];a.showFilterDropdown(r)}}),r.push({use:function(){return i.option.contextMenuOn.showAssistArea},title:function(t,e,n){return i.state.showAssistAreaInAreaSetting?i.option.contextMenuTitle.hideAssistArea:i.option.contextMenuTitle.showAssistArea},processor:function(t,e,n){i.state.showAssistAreaInAreaSetting=!i.state.showAssistAreaInAreaSetting,i.render()}}),r.push({use:function(){return i.option.contextMenuOn.showAssistHandle},title:function(t,e,n){return i.state.showAssistHandleInAreaSetting?i.option.contextMenuTitle.hideAssistHandle:i.option.contextMenuTitle.showAssistHandle},processor:function(t,e,n){i.state.showAssistHandleInAreaSetting=!i.state.showAssistHandleInAreaSetting,i.render()}}),r.push({use:function(){return i.option.contextMenuOn.valueDropDownn},title:function(){return i.option.contextMenuTitle.showValueDropDown},processor:function(t,e,n){var o=e.offset();i.removeValueDropDown(),i.attachValueDropDown(o.left,o.top+e.outerHeight())}}),r},prepareGrid:function(){var e=this;if(!e.$grid||!e.$grid.length)return void a("[prepareGrid] no grid element set.");var i=e.generateColumn();e.state.column=i;var r=e.$grid.alopexGrid("readOption").hiddenColumnOrderList||[],s=e.$grid.alopexGrid("readOption").columnMapping||[],l={};t.each(s,function(t,e){l[e.columnIndex]=e.key}),this.__preemptied||this.saveFilterOption();var u=[];t.each(r,function(t,n){"number"==typeof n&&(n=l[n]),e.isRow(n)||e.isColumn(n)||e.isValue(n)||u.push(n)}),u.length,e.state.groupKeys.length,e.state.rows.length,e.state.columns.length,e.hiddenOrder=u,o("[hiddenColumnArea] prev order : "+(r.join(", ")||"none")),o("[hiddenColumnArea] order : "+(u.join(", ")||"none")),e.$grid.addClass(n.classNameMap.grouperRootGrid),e.$grid.alopexGrid("dataEmpty"),e.$grid.alopexGrid(t.extend(!0,{},e.option.gridOption.preGrouper,{height:e.option.height,width:e.option.width,headerRowHeight:e.option.rowHeight,rowOption:{defaultHeight:e.option.rowHeight},autoColumnIndex:!0,hiddenColumnArea:!0,disableTextSelection:!0,cellSelectable:!1,enableDefaultContextMenu:!1,enableContextMenu:!0,rowClickSelect:!1,contextMenu:e.getContextMenuItems(),message:{nodata:e.option.nodataMsg,filterNodata:e.option.filterNodataMsg},hiddenColumnOrderList:u,columnMapping:i.columnMapping,columnFixUpto:i.horizontalColumnMapping.length?i.horizontalColumnMapping[i.horizontalColumnMapping.length-1].key||i.horizontalColumnMapping[i.horizontalColumnMapping.length-1].id:e.getLastRow(),headerGroup:i.headerGroup,grouping:{useGrouping:!0,by:[].concat(e.state.rows),useGroupFooter:e.getRowVisibleSubtotalList(),foldedGroupFooter:e.getRowVisibleMapForFolded(),useGroupHeader:[],useGroupRowspan:!0,showGroupSummaryOnly:!0,groupRowspanMode:2},footer:{position:e.state.showGrandTotalInRowSetting?"bottom":null,footerMapping:e.state.showGrandTotalInRowSetting?i.footerMapping:null},clientSortingOnDynamicDataSet:!1},e.option.gridOption.postGrouper)),e.prepareEventHandler()},addRenderCallback:function(t){this.option.renderCallback.add(t)},removeRenderCallback:function(t){this.option.renderCallback.remove(t)},render:function(t){var e=0;if(o("Start rendering"),this.$grid&&this.$grid.length||(e++,a("No grid element set.")),i(this.state.groupKeys)||(e++,a("No groupKeys set.")),i(this.state.rows)||(e++,a("No row key.")),e)return void a(e+" error"+(e>1?"s":"")+" detected. abort.");var r=this;r.$grid&&r.$grid.hasClass(n.classNameMap.grouperRootGrid)&&r.$grid.alopexGrid("showProgress");var s=(new Date).getTime();setTimeout(function(){r._render(t),o("[render] load completed. "+((new Date).getTime()-s)+"ms")},10)},_render:function(e){o("call ___render");var n=this,a=(new Date).getTime();n.prepareGrid(),n.sortData(),o("[render] prepare "+((new Date).getTime()-a)+"ms"),a=(new Date).getTime(),n.$grid.alopexGrid("dataSet",n.option.data,{sorting:t.map(n.getSorting(),function(t){return{sortingColumn:t.groupKey,sortingDirection:t.sorting>0?"asc":"desc"}})}),n.restoreFilterOption(),o("[render] dataSet "+((new Date).getTime()-a)+"ms"),n.$grid.alopexGrid("hideProgress"),t.isFunction(e)&&e(n),n.option.renderCallback.fireWith(n,[n])},updateOption:function(e){o("call updateOption");var n,i=this,r=i.option,s=i.state,l=["column","data"],u=!1;for(var p in r)if(n=p,!(l.indexOf(p)>-1)&&e.hasOwnProperty(p)){if("keyRender"==p){var d=e[p];if(!t.isFunction(d)&&null!==d)return void a("[keyRender] parameter should be either function or null.")}if("keyRenderHidden"==p){var d=e[p];if(!t.isFunction(d)&&null!==d)return void a("[keyRenderHidden] parameter should be either function or null.")}"keyMapping"!=p&&"rowSetting"!=p&&"columnSetting"!=p&&"assistSetting"!=p&&"valueSetting"!=p||(i.updateSetting(e[p],p),i.enableAllValue(),i._updateConfigData()),u=!0,"configuration"==p&&(e[p].hasOwnProperty("layout")?(i._updateConfigOption(e[p]),i.changeConfigLayout(e[p])):i._updateConfigOption(e[p]),u=!1),t.isPlainObject(r[p])?r[p]=t.extend(!0,{},r[p],e[p]):(r[p]=e[p],n!==p&&(s[n]=e[p]))}o("[updateOption] "+e),1==u&&i.render()},updateSetting:function(e,n){var a=this;o("updateSetting");var i=!1,r=a.option,s=a.state,l=(a.state.keyToIndexMap=a.state.keyToIndexMap?a.state.keyToIndexMap:{},"keyMapping"==n?e:[]),u="rowSetting"==n?e:{},p="columnSetting"==n?e:{},d="assistSetting"==n?e:{},g="valueSetting"==n?e:{};"keyMapping"==n&&(s.rows=[],s.columns=[],a.clearValue(),r[n]=t.extend(!0,[],r[n],e),a.setKeyMapping(l),i=!0),"rowSetting"==n&&(r[n]=t.extend(!0,{},r[n],e),k(s,u),i=!0),"columnSetting"==n&&(r[n]=t.extend(!0,{},r[n],e),D(s,p),i=!0),"assistSetting"==n&&(r[n]=t.extend(!0,{},r[n],e),R(s,d),i=!0),"valueSetting"==n&&(r[n]=t.extend(!0,{},r[n],e),O(s,g),i=!0),!0===i&&a.render()},updateKeyMapping:function(n,o){var a=this,i=a.option.keyMapping;if(e(o)){t.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){var s=a.state.keyToIndexMap[n[r]],l=i[s];t.extend(l,o)}a.updateSetting(i,"keyMapping"),a.enableAllValue(),a._updateConfigData(),a.render()}},clearKeyMapping:function(){var t=this;t.option.keyMapping=[],t.state.keyToIndexMap=[],t.setInitialArea(t,[]),t._updateConfigData(),t.render()},deleteKeyMapping:function(t){var e=this;if("string"!=typeof t)throw new Error("[Pivot.deleteKeyMapping API] Parameter '"+t+"' is wrong.");var n=e.option.keyMapping,o=e.state.keyToIndexMap[t];if(void 0===o)throw new Error("[Pivot.deleteKeyMapping API] '"+t+"' isn't exists in KeyMapping Option.");n.splice(o,1),e.$grid.alopexGrid("updateOption",{columnMapping:[]}),e.state.keyToIndexMap=[],e.updateSetting(n,"keyMapping"),e._updateConfigData(),e.render()},addKeyMapping:function(e){var n=this,o=n.option.keyMapping;if("object"!=typeof e)throw new Error("[Pivot.addKeyMapping API] Parameter '"+e+"' is wrong.");t.isArray(e)||(e=[e]),o=o.concat(e),n.updateSetting(o,"keyMapping"),n._updateConfigData(),n.render()},getKeyMapping:function(t){var e=this;if("string"!=typeof t)throw new Error("[Pivot.getKeyMapping API] Parameter '"+t+"' is wrong.");var n=e.option.keyMapping,o=e.state.keyToIndexMap[t];return void 0!==o?n[o]:null},readOption:function(){return this.option},getOption:function(){return this.option},_readState:function(){return this.state},getArea:function(t){var e=this,n=result=[];n=0==arguments.length?["row","column","value"]:[t.toLowerCase()];for(var o=0;o<n.length;o++){var a={};if(area=n[o],"row"!=area&&"column"!=area&&"value"!=area)throw new Error("[Pivot.getArea API] Parameter '"+t+"' is wrong.");a.area=area,a.setting=e.readOption()[area+"Setting"],a.keyList=e._readState()[area+"s"],result.push(a)}return result},getRowInfo:function(){var t=this,e={area:"row"};return e.setting=t.readOption().rowSetting,e.keyList=t._readState().rows,e},getColumnInfo:function(){var t=this,e={area:"column"};return e.setting=t.readOption().columnSetting,e.keyList=t._readState().columns,e},getValueInfo:function(){var t=this,e={area:"value"};return e.setting=t.readOption().valueSetting,e.keyList=t._readState().values,e},getValueList:function(){return this.state.values},_generateConfig:function(){var e=this;if(!e.option.hasOwnProperty("configuration"))return!1;var a,i,r,s=e.option.configuration,l=!1;if(!s.hasOwnProperty("$wrapper"))return!1;o("generateConfig"),r=s.$wrapper;var u=document.createElement("div");u.id=x("key");var p=t(u),d=document.createElement("div");d.id=x("column");var g=t(d),c=document.createElement("div");c.id=x("row");var h=t(c),f=document.createElement("div");f.id=x("value");var w=t(f),y=document.createElement("div");e.$leftEl=t(y);var m=document.createElement("div");e.$rightEl=t(m),r.addClass(n.classNameMap.grouperRootGrid+" config-wrapper"),e.$leftEl.addClass(n.classNameMap.configLayoutLeft),e.$rightEl.addClass(n.classNameMap.configLayoutRight);var v=s.layout||0;0==v?(y.appendChild(p[0]),m.appendChild(g[0]),m.appendChild(h[0]),m.appendChild(w[0])):1==v?(y.appendChild(p[0]),y.appendChild(g[0]),m.appendChild(h[0]),m.appendChild(w[0])):2==v&&(y.appendChild(p[0]),y.appendChild(h[0]),m.appendChild(g[0]),m.appendChild(w[0]),l=!0),r[0].appendChild(y),r[0].appendChild(m),e.$key=t("#"+u.id),e._initConfigGrid("key"),p.addClass(n.classNameMap.grouperRootGrid+" "+n.classNameMap.configKey);var C=e.state.groupKeys;if(e.$key.alopexGrid("dataSet",b(C,_)),e.$column=t("#"+d.id),e._initConfigGrid("column"),g.addClass(n.classNameMap.grouperRootGrid+" "+n.classNameMap.configColumn),i=b(e.state.columns,_,"column",e.usedKeyMap),e.$column.alopexGrid("dataSet",i),a=i,e.$row=t("#"+c.id),e._initConfigGrid("row"),h.addClass(n.classNameMap.grouperRootGrid+" "+n.classNameMap.configRow),i=b(e.state.rows,_,"row",e.usedKeyMap),e.$row.alopexGrid("dataSet",i),a=a.concat(i),e.$value=t("#"+f.id),e._initConfigGrid("value"),w.addClass(n.classNameMap.grouperRootGrid+" "+n.classNameMap.configValues),i=b(e.state.values,_,"value",e.usedKeyMap),e.$value.alopexGrid("dataSet",i),a=a.concat(i),1==l){e.$rightEl.children().addClass(n.classNameMap.configLayoutHorize);var S=p.outerHeight();e.$rightEl.children().css("top",S+"px")}return a.length>0&&e.$key.alopexGrid("rowSelect",AlopexGrid.trimData(a),!0),!0},updateConfig:function(){o("call updateConfig"),this._updateConfigData()},_updateConfigData:function(){o("call ____updateConfigData");var t,e,n=this,a=n.$key,i=n.$row,r=n.$column,s=n.$value;if(a&&i&&r&&s){var l=n.state.groupKeys;a.alopexGrid("dataSet",b(l,_)),e=b(n.state.columns,_,"column",n.usedKeyMap),r.alopexGrid("dataSet",e),t=e,e=b(n.state.rows,_,"row",n.usedKeyMap),i.alopexGrid("dataSet",e),t=t.concat(e),e=b(n.state.values,_,"value",n.usedKeyMap),s.alopexGrid("dataSet",e),t=t.concat(e),t.length>0&&a.alopexGrid("rowSelect",AlopexGrid.trimData(t),!0)}n._changeAreaInfo()},changeConfigLayout:function(t){var e=this,a=e.$key,i=e.$column,r=e.$row,s=e.$value,l=e.$leftEl,u=e.$rightEl;o("change configuration shape");var p=t.layout;u.children().css("top","0px"),l.children().detach(),u.children().detach("div"),AlopexGrid.renderUtil.removeClass(i[0],n.classNameMap.configLayoutHorize),AlopexGrid.renderUtil.removeClass(s[0],n.classNameMap.configLayoutHorize),0==p?(l[0].appendChild(a[0]),u[0].appendChild(i[0]),u[0].appendChild(r[0]),u[0].appendChild(s[0])):1==p?(l[0].appendChild(a[0]),l[0].appendChild(i[0]),u[0].appendChild(r[0]),u[0].appendChild(s[0])):2==p&&(l[0].appendChild(a[0]),l[0].appendChild(r[0]),u[0].appendChild(i[0]),u[0].appendChild(s[0]),AlopexGrid.renderUtil.addClass(i[0],n.classNameMap.configLayoutHorize),AlopexGrid.renderUtil.addClass(s[0],n.classNameMap.configLayoutHorize),u.children().css("top",a.outerHeight()+"px"))},_updateConfigOption:function(t){o("call ____updateConfigOption");var e=this,n=e.option.hasOwnProperty("configuration")?e.option.configuration:{},a=e.$key,i=e.$row,r=e.$column,s=e.$value,l={},u={},p={},d={};if(t.hasOwnProperty("height")){var g=t.height,c=n.hasOwnProperty("height")?n.height:{};(g.hasOwnProperty("keyConfig")||g.hasOwnProperty("allConfig"))&&(l.height=g.keyConfig||c.keyConfig||g.allConfig),(g.hasOwnProperty("rowConfig")||g.hasOwnProperty("allConfig"))&&(u.height=g.rowConfig||c.rowConfig||g.allConfig),(g.hasOwnProperty("columnConfig")||g.hasOwnProperty("allConfig"))&&(p.height=g.columnConfig||c.columnConfig||g.allConfig),(g.hasOwnProperty("valueConfig")||g.hasOwnProperty("allConfig"))&&(d.height=g.valueConfig||c.valueConfig||g.allConfig)}if(t.hasOwnProperty("width")){var h=t.width,f=n.hasOwnProperty("width")?n.width:{};(h.hasOwnProperty("keyConfig")||h.hasOwnProperty("allConfig"))&&(l.width=h.keyConfig||f.keyConfig||h.allConfig),(h.hasOwnProperty("rowConfig")||h.hasOwnProperty("allConfig"))&&(u.width=h.rowConfig||f.rowConfig||h.allConfig),(h.hasOwnProperty("columnConfig")||h.hasOwnProperty("allConfig"))&&(p.width=h.columnConfig||f.columnConfig||h.allConfig),(h.hasOwnProperty("valueConfig")||h.hasOwnProperty("allConfig"))&&(d.width=h.valueConfig||f.valueConfig||h.allConfig)}if(t.hasOwnProperty("title")){var w=t.title,y=n.hasOwnProperty("title")?n.title:{};(w.hasOwnProperty("keyConfig")||w.hasOwnProperty("allConfig"))&&(l.title=w.keyConfig||y.keyConfig||w.allConfig),(w.hasOwnProperty("rowConfig")||w.hasOwnProperty("allConfig"))&&(u.title=w.rowConfig||y.rowConfig||w.allConfig),(w.hasOwnProperty("columnConfig")||w.hasOwnProperty("allConfig"))&&(p.title=w.columnConfig||y.columnConfig||w.allConfig),(w.hasOwnProperty("valueConfig")||w.hasOwnProperty("allConfig"))&&(d.title=w.valueConfig||y.valueConfig||w.allConfig)}if(t.hasOwnProperty("clickSelect")){t.clickSelect}if(t.hasOwnProperty("singleSelect")){t.singleSelect}a.alopexGrid("updateOption",l),i.alopexGrid("updateOption",u),r.alopexGrid("updateOption",p),s.alopexGrid("updateOption",d)},_changeAreaInfo:function(){for(var t=this,e=t.usedKeyMap,n=t.option.keyMapping,o=0;o<n.length;o++){var a=n[o];a.area=e[a.key]?e[a.key]:null}},_initConfigGrid:function(t){var e=this,o=e.option.configuration.hasOwnProperty("width")?e.option.configuration.width:{},a=e.option.configuration.hasOwnProperty("height")?e.option.configuration.height:{},i={key:300,other:200},r=e.option.configuration.hasOwnProperty("title")?e.option.configuration.title:{},s={key:"Keys",column:"Columns",row:"Rows",value:"Values"},l=o.hasOwnProperty("allConfig")?o.allConfig:"content",u=a.hasOwnProperty("allConfig")?a.allConfig:i.key,p=a.hasOwnProperty("allConfig")?a.allConfig:i.other;AlopexGrid.define("configOption",{autoColumnIndex:!0,enableDefaultContextMenu:!1,fitTableWidth:!0,header:!1,rowOption:{defaultHeight:20},hideGridFoldingButton:!0,titleMarkup:'<div class="'+n.classNameMap.configIcon+'"></div>'}),AlopexGrid.define("selectMappingOption",{rowSelectOption:{clickSelect:!0},columnMapping:[{dragdropColumn:!0,excludeFitWidth:!0,width:20},{selectorColumn:!0,excludeFitWidth:!0,width:20},{key:_,width:150}]}),AlopexGrid.define("columnMappingOption",{columnMapping:[{dragdropColumn:!0,excludeFitWidth:!0,width:20},{key:_}]});var d=o.hasOwnProperty("keyConfig")?o.keyConfig:l,g=a.hasOwnProperty("keyConfig")?a.keyConfig:u,c=r.hasOwnProperty("keyConfig")?r.keyConfig:s.key,h={width:d,height:g,title:c,extend:["configOption","selectMappingOption"]},f=o.hasOwnProperty("rowConfig")?o.rowConfig:l,w=a.hasOwnProperty("rowConfig")?a.rowConfig:p,y=r.hasOwnProperty("rowConfig")?r.rowConfig:s.row,m={width:f,height:w,title:y,extend:["configOption","columnMappingOption"]},v=o.hasOwnProperty("columnConfig")?o.columnConfig:l,C=a.hasOwnProperty("columnConfig")?a.columnConfig:p,S=r.hasOwnProperty("columnConfig")?r.columnConfig:s.column,M={width:v,height:C,title:S,extend:["configOption","columnMappingOption"]},x=o.hasOwnProperty("valueConfig")?o.valueConfig:l,b=a.hasOwnProperty("valueConfig")?a.valueConfig:p,A=r.hasOwnProperty("valueConfig")?r.valueConfig:s.value,G={width:x,height:b,title:A,extend:["configOption","columnMappingOption"]};return"key"==t?void new AlopexGrid(e.$key,h):void("row"==t?new AlopexGrid(e.$row,m):"column"==t?new AlopexGrid(e.$column,M):"value"==t&&new AlopexGrid(e.$value,G))},_configEventHandler:function(){var t=this,e=t.$key,n=t.$column,a=t.$row,i=t.$value,r={};r.pivotGrid=t.$grid,r.usedKeyMap=t.usedKeyMap,r.$key=t.$key,r.$column=t.$column,r.$row=t.$row,r.$value=t.$value;var s=e.add(n).add(a).add(i),l=n.add(a).add(i);s.on("rowDragOver",function(t){for(var e,n=AlopexGrid.parseEvent(t),o=n.dragDataList,a=n.$grid,i=n.toAnotherGrid,r=G(a.attr("id")),s=0;s<o.length;s++)return e=AlopexGrid.trimData(o[s]),0==i?"key"!=r:!(a.alopexGrid("dataGet",e).length>0)||"key"==r&&(a.alopexGrid("rowSelect",e,!1),!0)}),l.on("rowDragDropEnd",r,function(t){var e=AlopexGrid.parseEvent(t),n=e.$grid,a=e.toAnotherGrid,i=t.data.pivotGrid;if(0==a){var r=AlopexGrid.trimData(n.alopexGrid("dataGet")),s=A(r,"groupKey"),l=G(n.attr("id"));switch(l){case"column":i.alopexGridPivot("setColumn",s);break;case"row":i.alopexGridPivot("setRow",s);break;case"value":i.alopexGridPivot("clearValue"),i.alopexGridPivot("addValueList",s),i.alopexGridPivot("enableAllValue")}o("[config] "+l+" Grid innerDrag, DragDrop"),i.alopexGridPivot("render")}}),e.on("dataDeleteEnd",r,function(t){var e=(t.data.usedKeyMap,AlopexGrid.parseEvent(t)),n=e.$grid,o=G(n.attr("id")),a=e.datalist[0];"key"==o&&0==a._state.added&&n.alopexGrid("dataUndelete",{_index:{id:a._index.id}})}),s.on("dataAddEnd",r,function(t){var e=t.data.pivotGrid,n=t.data.usedKeyMap,a=AlopexGrid.parseEvent(t),i=a.datalist[0].groupKey,r=a.$grid,s=r.alopexGrid("dataGet",{_index:{row:a.datalist[0]._index.row+1}}),l=G(r.attr("id")),u=n[i];switch(l){case"column":n[i]!=l&&(1==s.length?e.alopexGridPivot("insertColumnBefore",i,s[0].groupKey):e.alopexGridPivot("addColumn",i));break;case"row":n[i]!=l&&(1==s.length?e.alopexGridPivot("insertRowBefore",i,s[0].groupKey):e.alopexGridPivot("addRow",i));break;case"value":e.alopexGridPivot("isValueEnabled",i)||n[i]==l||(e.alopexGridPivot("insertValueBefore",i,s[0]?s[0].groupKey:null),e.alopexGridPivot("enableValue",i));break;case"key":2==r.alopexGrid("dataGet",{groupKey:i}).length&&r.alopexGrid("dataDelete",{_state:{added:!0}})}if("key"!=l&&t.data.$key.alopexGrid("rowSelect",AlopexGrid.trimData(a.datalist[0]),!0),l!=u){switch(u){case"column":e.alopexGridPivot("deleteColumn",i);break;case"row":e.alopexGridPivot("deleteRow",i);break;case"value":e.alopexGridPivot("deleteValue",i),e.alopexGridPivot("addGroupKey",i)}"key"!=l&&(n[i]=l)}o("[config] "+l+" Grid outerDrag, dataAdd"),e.alopexGridPivot("render"),e.alopexGridPivot("updateConfig")}),e.on("dataSelectEnd",r,function(t){var e=t.data.pivotGrid,n=t.data.$column,a=t.data.$row,i=t.data.$value,r=t.data.usedKeyMap,s=AlopexGrid.parseEvent(t),l=s.select,u=s.datalist[0],p=u.groupKey,d=u._state.selected,g=r[p];if("toggle"==l)if(0==d){switch(u=AlopexGrid.trimData(u),g){case"column":e.alopexGridPivot("deleteColumn",p),n.alopexGrid("dataDelete",u);break;case"row":e.alopexGridPivot("deleteRow",p),a.alopexGrid("dataDelete",u);break;case"value":e.alopexGridPivot("deleteValue",p),i.alopexGrid("dataDelete",u)}o("[config] value Grid keyCheckUncheck, dataSelect"),delete r[p],e.alopexGridPivot("render")}else 1==d&&0==!!g&&(1==u._index.row?a.alopexGrid("dataAdd",AlopexGrid.trimData(u)):i.alopexGrid("dataAdd",AlopexGrid.trimData(u)),o("[config] value Grid keyCheck to newbie!"))})},removeConfigEvent:function(){var t=this,e=t.$key,n=t.$column,o=t.$row,a=t.$value,i=e.add(n).add(o).add(a),r=n.add(o).add(a);i.off("rowDragOver"),r.off("rowDragDropEnd"),e.off("dataDeleteEnd"),i.off("dataAddEnd"),e.off("dataSelectEnd")},clearUsedKey:function(t){for(var e=this,n=e.usedKeyMap,o=e.state.groupKeys,a=0;a<o.length;a++){n[o[a]]===t&&delete n[o[a]]}},setInitialArea:function(){o("setInitialArea");var t=this,e=t.state,n=t.option,a=n.hasOwnProperty("keyMapping")?n.keyMapping:[],i=n.hasOwnProperty("rowSetting")?n.rowSetting:{},r=n.hasOwnProperty("columnSetting")?n.columnSetting:{},s=n.hasOwnProperty("assistSetting")?n.assistSetting:{},l=n.hasOwnProperty("valueSetting")?n.valueSetting:{};e.rows=[],e.columns=[],e.values=[],t.setKeyMapping(a),Object.keys(i).length>0&&k(e,i),Object.keys(r).length>0&&D(e,r),Object.keys(s).length>0&&R(e,s),Object.keys(l).length>0&&O(e,l)},setKeyMapping:function(e){for(var n=this,i=n.state,r=(n.state.groupKeys=[],n.state.keyToIndexMap=n.state.keyToIndexMap?n.state.keyToIndexMap:{}),s=0;s<e.length;s++){var l=e[s],u=l.key;if(l.hasOwnProperty("key")){if(r[l.key]=s,n.addGroupKey(u),l.hasOwnProperty("area")){switch(l.area){case"row":i.rows.push(u);break;case"column":i.columns.push(u);break;case"value":i.values.push(u)}}if(l.hasOwnProperty("width")&&(i.columnWidthMap[u]=parseInt(l.width)),l.hasOwnProperty("subtotalTitle")&&(i.subtotalTitleMap[u]=l.subtotalTitle),l.hasOwnProperty("showSubtotal")){var p=l.showSubtotal;if("boolean"!=typeof p)return void a("[keyMappping.showSubtotal] wrong arguments.");i.showSubtotalMap[u]=p}if(l.hasOwnProperty("keyRender")&&(i.keyRenderMap[u]=l.keyRender),l.hasOwnProperty("dataRender")&&(i.dataRenderMap[u]=l.dataRender),
l.hasOwnProperty("statsRender")){var d=l.statsRender;t.isFunction(d)&&(i.statsRenderMap[u]=d,o("[keyMappping.statsRender] renderer for "+u+" set"),o(d))}if(l.hasOwnProperty("statsParser")){var g=l.statsParser;t.isFunction(g)&&(i.statsParserMap[u]=g,o("[keyMappping.statsParser] parser for "+u+" set"),o(g))}if(l.hasOwnProperty("statsFunction")){var c=l.statsFunction;if(!t.isFunction(c)&&null!==c)return void a("[keyMappping.statsFunction] parameter should be either function or null.");i.statsFunctionMap[u]=c}l.hasOwnProperty("statsClass")&&(i.statsClassMap[u]=l.statsClass),l.hasOwnProperty("statsColumnOption")&&(i.statsColumnOptionMap[u]=l.statsColumnOption)}}}});var $=function(e){if(!this.length)return this;if("string"==typeof e){if(!n.prototype[e])throw new Error("[AlopexGrid Plugin-Grouper] Grouper has no method ["+e+"]");var o=void 0,a=void 0,i=t.makeArray(arguments).slice(1);return a=this.each(function(t,a){var r=P(this);if(r||(r=new n(this)),void 0!==(o=r[e].apply(r,i)))return!1}),void 0!==o?o:a}return this.each(function(t,o){var a=P(this);a?a.updateOption(e):a=new n(this,e)})};t.fn[V]=$,window[K]=n}(jQuery);