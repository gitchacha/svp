/**
 * Alopex UI v3.0.7
 * https://ui.alopex.io
 *
 *  * Copyright (c) 2018 SK Holdings C&C. All rights reserved.
 *  *
 *  * This software is the confidential and proprietary information of SK Holdings C&C
 *  * You shall not disclose such confidential information and shall use it only in
 *  * accordance with the terms of the license agreement you entered into with SK Holdings C&C.
 *
 * Date : 2019-07-18 14:07:04 GMT+0900 (대한민국 표준시)
 **/
var Alopexbpmn=function(){var e=this;e.debug=!1,e.fn={external:{}},e.util={},e.commonObject={diagram:null,root:null,$root:null,template:{Node:void 0,Link:void 0,Group:void 0},defaultContextMenu:{wf_contextmenu_arrange:{title:"Arrange",validation:function(e,t,n){return n&&n.model.nodeDataArray.length>0},callback:function(e){$(e.div).bpmn("autoArrange")}},wf_contextmenu_zoomtofit:{title:"Zoom To Fit",validation:function(e,t,n){return n&&n.model.nodeDataArray.length>0},callback:function(e){$(e.div).bpmn("zoomToFit")}},wf_contextmenu_cut:{title:"Cut",validation:function(e,t,n){return e&&t.canCutSelection()},callback:function(e){e.commandHandler.cutSelection()}},wf_contextmenu_copy:{title:"Copy",validation:function(e,t,n){return e&&t.canCopySelection()},callback:function(e){e.commandHandler.copySelection()}},wf_contextmenu_paste:{title:"Paste",validation:function(e,t,n){return t.canPasteSelection()},callback:function(e){e.commandHandler.pasteSelection(e.lastInput.documentPoint)}},wf_contextmenu_undo:{title:"Undo",validation:function(e,t,n){return t.canUndo()},callback:function(e){e.commandHandler.undo()}},wf_contextmenu_redo:{title:"Redo",validation:function(e,t,n){return t.canRedo()},callback:function(e){e.commandHandler.redo()}},wf_contextmenu_delete:{title:"Delete",validation:function(e,t,n){return e&&t.canDeleteSelection()},callback:function(e){e.commandHandler.deleteSelection()}},wf_contextmenu_deleteall:{title:"Delete All",validation:function(e,t,n){return!!(n&&n.model.nodeDataArray.length>0)},callback:function(e){e.div.bpmn.$root.bpmn("clearDiagram")}}}},e.fn.init=function(e,t){e.bpmn||(e.bpmn=$.extend(!0,{},$a.bpmn.commonObject),e.bpmn.root=e,e.bpmn.$root=t)},e.fn.fnMapper=function(e,t,n){if(t){if("function"==typeof $a.bpmn.fn.external[t])return $a.bpmn.fn.external[t].apply(e.bpmn,[n]);$a.bpmn.util.log("error","function is undefined",t)}else $a.bpmn.util.log("error","invalid fnName",t)},e.util.log=function(e,t,n){if(window.console&&(!0===$a.bpmn.debug||"log"!==e)){var o="[Alopex bpmn "+e+"] "+t;n&&(o+=" : "+n),console[e](o)}},e.fn.createNode=function(e,t){if(e)if(!t||t.length<=0)console.error("dataArray for createNode API is invalid");else{e.startTransaction("Add State"),e.model.addNodeDataCollection(t);var n=e.findNodeForData(t[0]);e.select(n),e.commitTransaction("Add State"),e.scrollToRect(n.actualBounds)}else console.error("diagram is invalid in createNode API")},e.fn.autoArrangeGroup=function(t){var n=[];this.diagram.findTopLevelGroups().each(function(e){e.layout.isValidLayout=!1,n.push(e)}),this.diagram.layoutDiagram(),e.fn.external.groupShapeSizeRecalculation.call(this,{groupArray:n})},e.fn.external.getElement=function(){return this.element},e.fn.external.getDiagram=function(){return this.diagram},e.fn.external.getDefaultContextMenu=function(){return this.defaultContextMenu},e.fn.external.getSelection=function(){return this.diagram.selection},e.fn.external.setSelection=function(e){var t=e.collection;this.diagram.selectCollection(t)},e.fn.external.getNodeDataForKey=function(e){var t=e.key;return this.diagram.findNodeForKey(t).data},e.fn.external.updateNodeDataForNode=function(t){var n=t.node;if(!n||!n.data)return $a.bpmn.util.log("error","node is invalid",n),null;e.fn.external.updateNodeDataForKey.call(this,{key:n.data.key})},e.fn.external.updateNodeDataForKey=function(e){var t=e.key,n=$.extend(!0,{},e.data),o=this.diagram.findNodeForKey(t);for(var a in this.diagram.startTransaction("changeProperties"),n)r(a)&&("category"===a?this.diagram.model.setCategoryForNodeData(o.data,n[a]):this.diagram.model.setDataProperty(o.data,a,n[a]));function r(e){return!(["isGroup","__gohashid"].filter(function(t){return e===t}).length>0)}this.diagram.commitTransaction("changeProperties")},e.fn.external.getModelData=function(e){var t=this.diagram,n=null,o=e.type;n=t.model.toJson();return"object"===o&&(n=JSON.parse(n)),n},e.fn.external.setModelData=function(e){var t=this.diagram,n=e.data,o=e.type;o&&"object"===o&&(n=JSON.stringify(n)),t.model=go.Model.fromJson(n)},e.fn.external.createDiagram=function(e){var t=e.data,n=e.option,o=e.divId,a=e.properties,r=goObj(go.Diagram,o,a);return this.diagram=r,r.userOption=n,r.model=go.Model.fromJson(t),r.model.undoManager.isEnabled=!0,r.isModified=!1,r.toolManager.linkingTool.temporaryLink.routing=go.Link.Normal,r.toolManager.linkingTool.temporaryLink.fromEndSegmentLength=0,r.toolManager.linkingTool.temporaryLink.toEndSegmentLength=0,r},e.fn.external.createOverview=function(e){var t=this.diagram,n=e.overviewDivId,o=goObj(go.Overview,n,{observed:t,contentAlignment:go.Spot.Center});return o.box.elt(0).stroke="dodgerblue",o.box.opacity=0,o},e.fn.external.setCustomContextMenu=function(t){var n=this.diagram,o=this.root,a=t.contextMenuId,r=t.contextHandlerObj;n.contextMenu=goObj(go.Adornment);var i=$.extend(!0,{},$a.bpmn.defaultContextMenu,r);!function(e,t,n){var o=document.getElementById(t);if(o.diagram=e,o)for(var a in n)u(o,a,n[a].title)}(n,a,i);var l=n.toolManager.contextMenuTool;$("#"+a).addClass("Wf-contextMenu");var d=document.getElementById(a);function c(e){l.stopTool(),l.canStart()&&(n.currentTool=l,l.doMouseUp())}function u(e,t,n){var o=self.document.createElement("LI");o.setAttribute("id",t),o.setAttribute("onclick","this.cxcommand(event)"),o.setAttribute("wfid",e.diagram.div.id),o.setAttribute("contextid",t+"_"+e.diagram.div.id),o.cxcommand=function(e,t){void 0===t&&(t=e.currentTarget.id);var n=e.currentTarget.getAttribute("wfid"),o=document.getElementById(n),a=o.bpmn.diagram,r=$(o).bpmn("getDefaultContextMenu");r[t]&&r[t].callback&&r[t].callback(a),a.currentTool.stopTool()};var a=self.document.createElement("A");a.setAttribute("href","#"),a.setAttribute("target","_self"),a.innerText=n,o.appendChild(a);var r=e.getElementsByTagName("UL")[0];r||(r=self.document.createElement("ul"),e.appendChild(r)),r.appendChild(o)}d?(o.contextmenuElement=d,d.root=o,d.$cxElement=$(d),d.addEventListener("contextmenu",function(e){return this.focus(),e.preventDefault(),!1},!1),document.body.addEventListener("click",function(e){e.target!==d&&"block"===d.style.display&&c()}),d.addEventListener("blur",c,!1),d.tabIndex="1",l.showContextMenu=function(e,t){var n=this.diagram;if(null!==n){e!==this.currentContextMenu&&this.hideContextMenu();var o=n.commandHandler,a=n.div.bpmn.$root,r=null,i=a.bpmn("getDefaultContextMenu"),l=d.$cxElement;for(r in i){var c=i[r],u=!!c.validation&&c.validation(t,o,n),f=l.find('li[contextid="'+r+"_"+a[0].id+'"]');self.document.getElementById(r);f.length>0&&(u?f.show():f.hide())}d.style.display="block",d.style.left=n.lastInput.event.pageX+"px",d.style.top=n.lastInput.event.pageY+"px",this.currentContextMenu=e}},l.hideContextMenu=function(){null!==this.currentContextMenu&&(d.style.display="none",this.currentContextMenu=null)}):e.fn.util.log("error","Cannot getElementById",a)},e.fn.external.changeLinkStyle=function(e){var t={Normal:{routing:go.Link.Normal,curve:go.Link.None,toShortLength:0,fromEndSegmentLength:0,toEndSegmentLength:0},Orthogonal:{routing:go.Link.Orthogonal,curve:go.Link.None,toShortLength:0,fromEndSegmentLength:0,toEndSegmentLength:0},Bezier:{routing:go.Link.Normal,curve:go.Link.Bezier,toShortLength:5,fromEndSegmentLength:30,toEndSegmentLength:30}},n=this.diagram,o=e.styleName;$.extend(n.linkTemplate,t[o]),n.model.linkDataArray.forEach(function(e){var a=n.findLinkForData(e);$.extend(a,t[o]),a.invalidateRoute()}),$.extend(n.toolManager.linkingTool.temporaryLink,t[o])},e.fn.external.addTemplate=function(e){var t=e.partClassName,n=e.category,o=e.template;this.template[t]||(this.template[t]=new go.Map("string",go[t])),this.template[t].add(n,o)},e.fn.external.getTemplateMap=function(e){var t=e.partClassName;return this.template[t]},e.fn.external.autoArrange=function(t){var n=this,o=n.diagram.findTopLevelGroups();o&&o.count>0&&e.fn.autoArrangeGroup.call(n,t),setTimeout(function(){n.diagram.layout.isValidLayout=!1,n.diagram.layoutDiagram(),e.fn.external.zoomToFit.call(n,t)},500)},e.fn.external.groupShapeSizeRecalculation=function(e){var t=e.groupArray;t.length>0&&t.forEach(function(e){if(e.isSubGraphExpanded){var t=[],n=e.memberParts;if(n&&n.count>0&&n.each(function(e){var n=e.actualBounds;t.push({left:n.x-n.width/2,top:n.y-n.height/2}),t.push({left:n.x+n.width/2,top:n.y+n.height/2})}),t.length>0){var o=0,a=0,r=0,i=0;t.forEach(function(e,t){0===t?(o=r=e.left,a=i=e.top):(o>e.left&&(o=e.left),a>e.top&&(a=e.top),r<e.left&&(r=e.left),i<e.top&&(i=e.top))});var l=r-o,d=i-a;if(0!==o&&0!==a&&0!==r&&0!==i&&l>=0&&d>=0){var c=e.findObject("SHAPE");c.minSize=new go.Size(l<1?60:l+60,d<1?80:d+80),c.desiredSize=new go.Size(l<1?60:l+60,d<1?80:d+80)}}}})},e.fn.external.zoomToFit=function(e){this.diagram.zoomToFit()},e.fn.external.clearDiagram=function(e){this.diagram.clear()},e.fn.external.createNodeByDrop=function(e){var t=this.diagram,n=e.nodeDataArray,o=e.dropLocationString;if($a.bpmn.fn.createNode(t,n),o){t.model.nodeDataArray[t.model.nodeDataArray.length-1];var a=go.Point.parse(o),r=null;(r=t.findObjectsNear(a,1,function(e){var t=e.part;return t instanceof go.Link?t:t instanceof go.Group?t:null},function(e){return!0},!0))&&r.size>0&&r.each(function(e){var n,o;if(e instanceof go.Link)!function(e,t){var n=e,o=n.selection.first();if(o instanceof go.Node){var a=t.part,r=a.fromNode,i=a.toNode,l={from:r.data.key,to:o.data.key};n.findLinksByExample(l).count<1?a.toNode=o:n.remove(a);var d={from:o.data.key,to:i.data.key};n.findLinksByExample(d).count<1&&n.model.addLinkData(d)}}(t,e);else if("subprocess"===e.category){n=e,o=t.selection,n.addMembers(o,!0)}})}},e.fn.external.getAllPathsArrayBetween=function(e){var t=e.node1,n=e.node2,o=r(t,n);if(o.count<=0&&(o=r(t,n)),o.count<=0)return null;var a=[];function r(e,t){var n=new go.List(go.Node),o=new go.List(go.List);return n.add(e),function e(t,a){t.findNodesOutOf().each(function(r){if(r!==t)if(r===a){var i=n.copy();i.add(a),o.add(i)}else n.contains(r)||(n.add(r),e(r,a),n.removeAt(n.count-1))})}(e,t),o}return o.each(function(e,t){var n=[];e.each(function(e,t){n.push(e.data.key)}),a.push(n)}),a}};window.$a.bpmn=new Alopexbpmn,$.fn.bpmn=function(){var e=this[0],t=arguments[0],n=arguments[1];if(e&&"DIV"===e.tagName){if(0===arguments.length)return $a.bpmn.fn.init(e,this),this;var o=$a.bpmn.fn.fnMapper(e,t,n);return void 0===o?this:o}$a.bpmn.util.log("error","element is not HTMLDivElement",e)};